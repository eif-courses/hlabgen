
ğŸš€ Starting generation for app: ClinicAPI (mode=hybrid)
âœ… Rule-based scaffold created
2025/10/19 21:25:58 ğŸ§  Starting ML-based code generation...
ğŸŒ Using custom endpoint: https://api.openai.com/v1
ğŸ¤– Trying model: gpt-4o-mini
â±ï¸  Model call took 36.646182794s (model: gpt-4o-mini, attempt: 1)
âŒ JSON error: invalid character 'e' after object key:value pair
âš ï¸ Primary parse failed, retrying with JSON repair prompt...
ğŸ¤– Trying model: gpt-4o-mini
â±ï¸  Model call took 32.784994812s (model: gpt-4o-mini, attempt: 1)
ğŸ” Repair call took 32.785049436s
âŒ JSON error: invalid character 'e' after object key:value pair
--- CLEANED JSON ---
[
  {
    "filename": "internal/models/doctor.go",
    "code": "package models\n\ntype Doctor struct {\n\tID        int    `json:\"id\"`\n\tName      string `json:\"name\"`\n\tSpecialty string `json:\"specialty\"`\n}\n"
  },
  {
    "filename": "internal/models/patient.go",
    "code": "package models\n\ntype Patient struct {\n\tID    int    `json:\"id\"`\n\tName  string `json:\"name\"`\n\tEmail string `json:\"email\"`\n}\n"
  },
  {
    "filename": "internal/models/appointment.go",
    "code": "package models\n\ntype Appointment struct {\n\tID        int    `json:\"id\"`\n\tDoctorID  int    `json:\"doctor_id\"`\n\tPatientID int    `json:\"patient_id\"`\n\tDate      string `json:\"date\"`\n}\n"
  },
  {
    "filename": "internal/handlers/doctor.go",
    "code": "package handlers\n\nimport (\n\t"encoding/json\"\n\t\"net/http\"\n\t\"ClinicAPI/internal/models\"\n)\n\nvar doctors []models.Doctor\n\nfunc CreateDoctor(w http.ResponseWriter, r *http.Request) {\n\tvar doctor models.Doctor\n\tif r.Body == nil {\n\t\thttp.Error(w, \"missing body\", http.StatusBadRequest)\n\t\treturn\n\t}\n\tif err := json.NewDecoder(r.Body).Decode(&doctor); err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\tdoctors = append(doctors, doctor)\n\tw.WriteHeader(http.StatusCreated)\n\tjson.NewEncoder(w).Encode(doctor)\n}\n\nfunc GetDoctors(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(doctors)\n}\n\nfunc GetDoctor(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for getting a single doctor\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc UpdateDoctor(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for updating a doctor\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc DeleteDoctor(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for deleting a doctor\n\tw.WriteHeader(http.StatusNoContent)\n}\n"
  },
  {
    "filename": "internal/handlers/patient.go",
    "code": "package handlers\n\nimport (\n\t"encoding/json\"\n\t\"net/http\"\n\t\"ClinicAPI/internal/models\"\n)\n\nvar patients []models.Patient\n\nfunc CreatePatient(w http.ResponseWriter, r *http.Request) {\n\tvar patient models.Patient\n\tif r.Body == nil {\n\t\thttp.Error(w, \"missing body\", http.StatusBadRequest)\n\t\treturn\n\t}\n\tif err := json.NewDecoder(r.Body).Decode(&patient); err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\tpatients = append(patients, patient)\n\tw.WriteHeader(http.StatusCreated)\n\tjson.NewEncoder(w).Encode(patient)\n}\n\nfunc GetPatients(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(patients)\n}\n\nfunc GetPatient(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for getting a single patient\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc UpdatePatient(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for updating a patient\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc DeletePatient(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for deleting a patient\n\tw.WriteHeader(http.StatusNoContent)\n}\n"
  },
  {
    "filename": "internal/handlers/appointment.go",
    "code": "package handlers\n\nimport (\n\t"encoding/json\"\n\t\"net/http\"\n\t\"ClinicAPI/internal/models\"\n)\n\nvar appointments []models.Appointment\n\nfunc CreateAppointment(w http.ResponseWriter, r *http.Request) {\n\tvar appointment models.Appointment\n\tif r.Body == nil {\n\t\thttp.Error(w, \"missing body\", http.StatusBadRequest)\n\t\treturn\n\t}\n\tif err := json.NewDecoder(r.Body).Decode(&appointment); err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\tappointments = append(appointments, appointment)\n\tw.WriteHeader(http.StatusCreated)\n\tjson.NewEncoder(w).Encode(appointment)\n}\n\nfunc GetAppointments(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(appointments)\n}\n\nfunc GetAppointment(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for getting a single appointment\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc UpdateAppointment(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for updating an appointment\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc DeleteAppointment(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for deleting an appointment\n\tw.WriteHeader(http.StatusNoContent)\n}\n"
  },
  {
    "filename": "internal/handlers/doctor_test.go",
    "code": "package handlers_test\n\nimport (\n\t"bytes\"\n\t"encoding/json\"\n\t\"net/http\"\n\t\"net/http/httptest\"\n\t\"testing\"\n\t\"ClinicAPI/internal/handlers\"\n\t\"ClinicAPI/internal/models\"\n)\n\nfunc TestCreateDoctor(t *testing.T) {\n\tdoctor := models.Doctor{\n\t\tName:      \"Test Doctor\",\n\t\tSpecialty: \"Cardiology\",\n\t}\n\tbody, _ := json.Marshal(doctor)\n\treq := httptest.NewRequest(\"POST\", \"/doctors\", bytes.NewBuffer(body))\n\tw := httptest.NewRecorder()\n\thandlers.CreateDoctor(w, req)\n\tif w.Code != http.StatusCreated {\n\t\tt.Errorf(\"Expected 201, got %d\", w.Code)\n\t}\n}\n\nfunc TestGetDoctors(t *testing.T) {\n\treq := httptest.NewRequest(\"GET\", \"/doctors\", nil)\n\tw := httptest.NewRecorder()\n\thandlers.GetDoctors(w, req)\n\tif w.Code != http.StatusOK {\n\t\tt.Errorf(\"Expected 200, got %d\", w.Code)\n\t}\n}\n"
  },
  {
    "filename": "internal/handlers/patient_test.go",
    "code": "package handlers_test\n\nimport (\n\t"bytes\"\n\t"encoding/json\"\n\t\"net/http\"\n\t\"net/http/httptest\"\n\t\"testing\"\n\t\"ClinicAPI/internal/handlers\"\n\t\"ClinicAPI/internal/models\"\n)\n\nfunc TestCreatePatient(t *testing.T) {\n\tpatient := models.Patient{\n\t\tName:  \"Test Patient\",\n\t\tEmail: \"test@example.com\",\n\t}\n\tbody, _ := json.Marshal(patient)\n\treq := httptest.NewRequest(\"POST\", \"/patients\", bytes.NewBuffer(body))\n\tw := httptest.NewRecorder()\n\thandlers.CreatePatient(w, req)\n\tif w.Code != http.StatusCreated {\n\t\tt.Errorf(\"Expected 201, got %d\", w.Code)\n\t}\n}\n\nfunc TestGetPatients(t *testing.T) {\n\treq := httptest.NewRequest(\"GET\", \"/patients\", nil)\n\tw := httptest.NewRecorder()\n\thandlers.GetPatients(w, req)\n\tif w.Code != http.StatusOK {\n\t\tt.Errorf(\"Expected 200, got %d\", w.Code)\n\t}\n}\n"
  },
  {
    "filename": "internal/handlers/appointment_test.go",
    "code": "package handlers_test\n\nimport (\n\t"bytes\"\n\t"encoding/json\"\n\t\"net/http\"\n\t\"net/http/httptest\"\n\t\"testing\"\n\t\"ClinicAPI/internal/handlers\"\n\t\"ClinicAPI/internal/models\"\n)\n\nfunc TestCreateAppointment(t *testing.T) {\n\tappointment := models.Appointment{\n\t\tDoctorID:  1,\n\t\tPatientID: 1,\n\t\tDate:      \"2023-10-01\",\n\t}\n\tbody, _ := json.Marshal(appointment)\n\treq := httptest.NewRequest(\"POST\", \"/appointments\", bytes.NewBuffer(body))\n\tw := httptest.NewRecorder()\n\thandlers.CreateAppointment(w, req)\n\tif w.Code != http.StatusCreated {\n\t\tt.Errorf(\"Expected 201, got %d\", w.Code)\n\t}\n}\n\nfunc TestGetAppointments(t *testing.T) {\n\treq := httptest.NewRequest(\"GET\", \"/appointments\", nil)\n\tw := httptest.NewRecorder()\n\thandlers.GetAppointments(w, req)\n\tif w.Code != http.StatusOK {\n\t\tt.Errorf(\"Expected 200, got %d\", w.Code)\n\t}\n}\n"
  },
  {
    "filename": "internal/routes/routes.go",
    "code": "package routes\n\nimport (\n\t\"github.com/gorilla/mux\"\n\t\"ClinicAPI/internal/handlers\"\n)\n\nfunc Register(r *mux.Router) {\n\t// Doctor routes\n\tr.HandleFunc(\"/doctors\", handlers.CreateDoctor).Methods(\"POST\")\n\tr.HandleFunc(\"/doctors\", handlers.GetDoctors).Methods(\"GET\")\n\tr.HandleFunc(\"/doctors/{id}\", handlers.GetDoctor).Methods(\"GET\")\n\tr.HandleFunc(\"/doctors/{id}\", handlers.UpdateDoctor).Methods(\"PUT\")\n\tr.HandleFunc(\"/doctors/{id}\", handlers.DeleteDoctor).Methods(\"DELETE\")\n\n\t// Patient routes\n\tr.HandleFunc(\"/patients\", handlers.CreatePatient).Methods(\"POST\")\n\tr.HandleFunc(\"/patients\", handlers.GetPatients).Methods(\"GET\")\n\tr.HandleFunc(\"/patients/{id}\", handlers.GetPatient).Methods(\"GET\")\n\tr.HandleFunc(\"/patients/{id}\", handlers.UpdatePatient).Methods(\"PUT\")\n\tr.HandleFunc(\"/patients/{id}\", handlers.DeletePatient).Methods(\"DELETE\")\n\n\t// Appointment routes\n\tr.HandleFunc(\"/appointments\", handlers.CreateAppointment).Methods(\"POST\")\n\tr.HandleFunc(\"/appointments\", handlers.GetAppointments).Methods(\"GET\")\n\tr.HandleFunc(\"/appointments/{id}\", handlers.GetAppointment).Methods(\"GET\")\n\tr.HandleFunc(\"/appointments/{id}\", handlers.UpdateAppointment).Methods(\"PUT\")\n\tr.HandleFunc(\"/appointments/{id}\", handlers.DeleteAppointment).Methods(\"DELETE\")\n}\n"
  },
  {
    "filename": "cmd/main.go",
    "code": "package main\n\nimport (\n\t\"log\"\n\t\"net/http\"\n\t\"github.com/gorilla/mux\"\n\t\"ClinicAPI/internal/routes\"\n)\n\nfunc main() {\n\tr := mux.NewRouter()\n\troutes.Register(r)\n\tlog.Println(\"Server listening on :8080\")\n\tlog.Fatal(http.ListenAndServe(\":8080\", r))\n}\n"
  },
  {
    "filename": "tasks.md",
    "code": "# Lab Tasks\n\n1. Implement the GetDoctor handler to return a single doctor by ID\n2. Implement the GetPatient handler to return a single patient by ID\n3. Implement the GetAppointment handler to return a single appointment by ID\n4. Add validation for required fields in CreateDoctor, CreatePatient, and CreateAppointment handlers\n5. Write additional test cases for UpdateDoctor, UpdatePatient, and UpdateAppointment handlers\n6. Implement error handling for doctor, patient, and appointment not found scenarios\n7. Add pagination support for the GetDoctors and GetPatients endpoints\n"
  }
]
--- END ---
ğŸ§¾ Saved ML metrics â†’ experiments/ClinicAPI/gen_metrics.json
2025/10/19 21:27:07 âš ï¸  ML generation failed once: failed to parse repaired output: json parse error: invalid character 'e' after object key:value pair
2025/10/19 21:27:07 ğŸ” Retrying with relaxed mode...
2025/10/19 21:27:07 ğŸª„ Using relaxed ML generation mode (cleaning JSON output)...
ğŸŒ Using custom endpoint: https://api.openai.com/v1
ğŸ¤– Trying model: gpt-4o-mini
â±ï¸  Model call took 31.639313412s (model: gpt-4o-mini, attempt: 1)
âœ… Parsed 12 files

ğŸ“Š Generation Summary:
  â€¢ Duration: 31.640030613s
  â€¢ Primary Success: true
  â€¢ Repair Attempts: 0
  â€¢ Final Success: true
  â€¢ Error: 
âœ… ClinicAPI generation completed successfully
ğŸ§¾ Saved ML metrics â†’ experiments/ClinicAPI/gen_metrics.json
2025/10/19 21:27:39 âœ… Normal ML generation succeeded â€” no relaxed mode needed.
ğŸ“ Processing: internal/models/doctor.go
âœ… Written: experiments/out/ClinicAPI/internal/models/doctor.go
ğŸ“ Processing: internal/models/patient.go
âœ… Written: experiments/out/ClinicAPI/internal/models/patient.go
ğŸ“ Processing: internal/models/appointment.go
âœ… Written: experiments/out/ClinicAPI/internal/models/appointment.go
ğŸ“ Processing: internal/handlers/doctor.go
ğŸ”§ Fixed handler signature for CreateDoctor
ğŸ”§ Fixed handler signature for GetDoctors
ğŸ”§ Fixed handler signature for GetDoctor
ğŸ”§ Fixed handler signature for UpdateDoctor
ğŸ”§ Fixed handler signature for DeleteDoctor
âœ… Written: experiments/out/ClinicAPI/internal/handlers/doctor.go
ğŸ“ Processing: internal/handlers/patient.go
ğŸ”§ Fixed handler signature for CreatePatient
ğŸ”§ Fixed handler signature for GetPatients
ğŸ”§ Fixed handler signature for GetPatient
ğŸ”§ Fixed handler signature for UpdatePatient
ğŸ”§ Fixed handler signature for DeletePatient
âœ… Written: experiments/out/ClinicAPI/internal/handlers/patient.go
ğŸ“ Processing: internal/handlers/appointment.go
ğŸ”§ Fixed handler signature for CreateAppointment
ğŸ”§ Fixed handler signature for GetAppointments
ğŸ”§ Fixed handler signature for GetAppointment
ğŸ”§ Fixed handler signature for UpdateAppointment
ğŸ”§ Fixed handler signature for DeleteAppointment
âœ… Written: experiments/out/ClinicAPI/internal/handlers/appointment.go
ğŸ“ Processing: internal/handlers/doctor_test.go
ğŸ”§ Fixed test signature for TestCreateDoctor
ğŸ”§ Fixed test signature for TestGetDoctors
âœ… Auto-fixed test signatures in internal/handlers/doctor_test.go
âœ… Written: experiments/out/ClinicAPI/internal/handlers/doctor_test.go
ğŸ“ Processing: internal/handlers/patient_test.go
ğŸ”§ Fixed test signature for TestCreatePatient
ğŸ”§ Fixed test signature for TestGetPatients
âœ… Auto-fixed test signatures in internal/handlers/patient_test.go
âœ… Written: experiments/out/ClinicAPI/internal/handlers/patient_test.go
ğŸ“ Processing: internal/handlers/appointment_test.go
ğŸ”§ Fixed test signature for TestCreateAppointment
ğŸ”§ Fixed test signature for TestGetAppointments
âœ… Auto-fixed test signatures in internal/handlers/appointment_test.go
âœ… Written: experiments/out/ClinicAPI/internal/handlers/appointment_test.go
ğŸ“ Processing: internal/routes/routes.go
ğŸ”§ Fixed Register function parameter
âœ… Written: experiments/out/ClinicAPI/internal/routes/routes.go
ğŸ“ Processing: cmd/main.go
âœ… Written: experiments/out/ClinicAPI/cmd/main.go
ğŸ“ Processing: tasks.md
âš ï¸  Syntax validation failed for tasks.md: temp.go:1:1: illegal character U+0023 '#'
ğŸ”§ Attempting additional fixes...
âŒ Could not auto-fix syntax errors in tasks.md
âœ… Written: experiments/out/ClinicAPI/tasks.md

ğŸ”§ Total rule-based fixes applied: 25

ğŸ”§ Running auto-fix on generated files...

ğŸ”§ Auto-fixing all files in: experiments/out/ClinicAPI

ğŸ“ Fixing test function signatures...
  âœ… Fixed test signatures in appointment_test.go
  âœ… Fixed test signatures in doctor_test.go
  âœ… Fixed test signatures in patient_test.go

ğŸ“ Fixing handler function signatures...

ğŸ“ Fixing routes Register function...

ğŸ“ Fixing missing commas in struct literals...

ğŸ“ Ensuring test file imports...

âœ… Applied 3 fixes total!
âœ… Auto-fix completed successfully

ğŸ” Validating Go syntax...
âœ… All generated files have valid Go syntax
2025/10/19 21:27:39 âœ… Generated 3 test file(s)

ğŸ”§ Fixing import paths...
2025/10/19 21:27:39 ğŸ”§ Detected module name: ClinicAPI â€” fixing imports...
2025/10/19 21:27:39 âœ… No import fixes needed
ğŸ”§ Running go mod tidy...
âœ… Dependencies tidied

ğŸ” Final syntax validation after fixes...
âœ… All syntax errors resolved
âœ… ML generation completed (31.64s)
ğŸ“ Saved per-package coverage â†’ experiments/out/ClinicAPI/coverage.json
ğŸ§¾ Added summary row (with ML metrics) â†’ experiments/logs/coverage.csv

--- go test summary ---

--- experiments/out/ClinicAPI/internal/handlers ---
=== RUN   TestCreateAppointment
--- PASS: TestCreateAppointment (0.00s)
=== RUN   TestGetAppointments
--- PASS: TestGetAppointments (0.00s)
=== RUN   TestCreateDoctor
--- PASS: TestCreateDoctor (0.00s)
=== RUN   TestGetDoctors
--- PASS: TestGetDoctors (0.00s)
=== RUN   TestCreatePatient
--- PASS: TestCreatePatient (0.00s)
=== RUN   TestGetPatients
--- PASS: TestGetPatients (0.00s)
PASS
coverage: 53.3% of statements
ok  	ClinicAPI/internal/handlers	0.002s

------------------------
âœ… Validation completed in 0.89s

ğŸ“Š Summary for ClinicAPI:
  â€¢ BuildSuccess = true
  â€¢ LintWarnings = 3
  â€¢ TestsPass    = true
  â€¢ Coverage     = 53.3%
  â€¢ Generation Duration = 31.640030613s
  â€¢ Repair Attempts = 0
  â€¢ Rule Fixes   = 25
  â€¢ Mode: hybrid
ğŸ§¾ Appended 30 experiments into experiments/logs/summary.csv

ğŸ§¾ Generating Markdown summary from JSON metrics...
ğŸ“Š Markdown results saved â†’ experiments/logs/results.md
âœ… Summary successfully written to experiments/logs/results.md

âœ… Experiment complete..
