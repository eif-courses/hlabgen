
ğŸš€ Starting generation for app: HealthAPI (mode=hybrid)
âœ… Rule-based scaffold created
2025/10/20 04:55:06 ğŸ§  Starting ML-based code generation...
ğŸŒ Using custom endpoint: https://api.openai.com/v1
ğŸ¤– Trying model: gpt-4o-mini
â±ï¸  Model call took 30.928427663s (model: gpt-4o-mini, attempt: 1)
âŒ JSON error: invalid character 'e' after object key:value pair
âš ï¸ Primary parse failed, retrying with JSON repair prompt...
ğŸ¤– Trying model: gpt-4o-mini
â±ï¸  Model call took 34.713181212s (model: gpt-4o-mini, attempt: 1)
ğŸ” Repair call took 34.713254045s
âŒ JSON error: invalid character 'e' after object key:value pair
--- CLEANED JSON ---
[
  {
    "filename": "internal/models/patient.go",
    "code": "package models\n\ntype Patient struct {\n\tID       int    `json:\"id\"`\n\tName     string `json:\"name\"`\n\tAge      int    `json:\"age\"`\n\tGender   string `json:\"gender\"`\n\tEmail    string `json:\"email\"`\n}\n"
  },
  {
    "filename": "internal/models/doctor.go",
    "code": "package models\n\ntype Doctor struct {\n\tID       int    `json:\"id\"`\n\tName     string `json:\"name\"`\n\tSpecialty string `json:\"specialty\"`\n\tEmail    string `json:\"email\"`\n}\n"
  },
  {
    "filename": "internal/models/record.go",
    "code": "package models\n\ntype Record struct {\n\tID        int     `json:\"id\"`\n\tPatientID int     `json:\"patient_id\"`\n\tDoctorID  int     `json:\"doctor_id\"`\n\tNotes     string  `json:\"notes\"`\n\tDate      string  `json:\"date\"`\n}\n"
  },
  {
    "filename": "internal/handlers/patient.go",
    "code": "package handlers\n\nimport (\n\t"encoding/json\n\t"net/http\"\n\t\"HealthAPI/internal/models\"\n)\n\nvar patients []models.Patient\n\nfunc CreatePatient(w http.ResponseWriter, r *http.Request) {\n\tvar patient models.Patient\n\tif r.Body == nil {\n\t\thttp.Error(w, \"missing body\", http.StatusBadRequest)\n\t\treturn\n\t}\n\tif err := json.NewDecoder(r.Body).Decode(&patient); err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\tpatients = append(patients, patient)\n\tw.WriteHeader(http.StatusCreated)\n\tjson.NewEncoder(w).Encode(patient)\n}\n\nfunc GetPatients(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(patients)\n}\n\nfunc GetPatient(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for getting a single patient\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc UpdatePatient(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for updating a patient\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc DeletePatient(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for deleting a patient\n\tw.WriteHeader(http.StatusNoContent)\n}\n"
  },
  {
    "filename": "internal/handlers/doctor.go",
    "code": "package handlers\n\nimport (\n\t"encoding/json\n\t"net/http\"\n\t\"HealthAPI/internal/models\"\n)\n\nvar doctors []models.Doctor\n\nfunc CreateDoctor(w http.ResponseWriter, r *http.Request) {\n\tvar doctor models.Doctor\n\tif r.Body == nil {\n\t\thttp.Error(w, \"missing body\", http.StatusBadRequest)\n\t\treturn\n\t}\n\tif err := json.NewDecoder(r.Body).Decode(&doctor); err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\tdoctors = append(doctors, doctor)\n\tw.WriteHeader(http.StatusCreated)\n\tjson.NewEncoder(w).Encode(doctor)\n}\n\nfunc GetDoctors(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(doctors)\n}\n\nfunc GetDoctor(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for getting a single doctor\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc UpdateDoctor(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for updating a doctor\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc DeleteDoctor(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for deleting a doctor\n\tw.WriteHeader(http.StatusNoContent)\n}\n"
  },
  {
    "filename": "internal/handlers/record.go",
    "code": "package handlers\n\nimport (\n\t"encoding/json\n\t"net/http\"\n\t\"HealthAPI/internal/models\"\n)\n\nvar records []models.Record\n\nfunc CreateRecord(w http.ResponseWriter, r *http.Request) {\n\tvar record models.Record\n\tif r.Body == nil {\n\t\thttp.Error(w, \"missing body\", http.StatusBadRequest)\n\t\treturn\n\t}\n\tif err := json.NewDecoder(r.Body).Decode(&record); err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\treturn\n\t}\n\trecords = append(records, record)\n\tw.WriteHeader(http.StatusCreated)\n\tjson.NewEncoder(w).Encode(record)\n}\n\nfunc GetRecords(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tjson.NewEncoder(w).Encode(records)\n}\n\nfunc GetRecord(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for getting a single record\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc UpdateRecord(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for updating a record\n\tw.WriteHeader(http.StatusOK)\n}\n\nfunc DeleteRecord(w http.ResponseWriter, r *http.Request) {\n\t// Implementation for deleting a record\n\tw.WriteHeader(http.StatusNoContent)\n}\n"
  },
  {
    "filename": "internal/handlers/patient_test.go",
    "code": "package handlers_test\n\nimport (\n\t"bytes\"\n\t"encoding/json\"\n\t"net/http\"\n\t"net/http/httptest\"\n\t"testing\"\n\t\"HealthAPI/internal/handlers\"\n\t\"HealthAPI/internal/models\"\n)\n\nfunc TestCreatePatient(t *testing.T) {\n\tpatient := models.Patient{\n\t\tName:  \"John Doe\",\n\t\tAge:   30,\n\t\tGender: \"Male\",\n\t\tEmail:  \"john@example.com\",\n\t}\n\tbody, _ := json.Marshal(patient)\n\treq := httptest.NewRequest(\"POST\", \"/patients\", bytes.NewBuffer(body))\n\tw := httptest.NewRecorder()\n\thandlers.CreatePatient(w, req)\n\tif w.Code != http.StatusCreated {\n\t\tt.Errorf(\"Expected 201, got %d\", w.Code)\n\t}\n}\n\nfunc TestGetPatients(t *testing.T) {\n\treq := httptest.NewRequest(\"GET\", \"/patients\", nil)\n\tw := httptest.NewRecorder()\n\thandlers.GetPatients(w, req)\n\tif w.Code != http.StatusOK {\n\t\tt.Errorf(\"Expected 200, got %d\", w.Code)\n\t}\n}\n"
  },
  {
    "filename": "internal/handlers/doctor_test.go",
    "code": "package handlers_test\n\nimport (\n\t"bytes\"\n\t"encoding/json\"\n\t"net/http\"\n\t"net/http/httptest\"\n\t"testing\"\n\t\"HealthAPI/internal/handlers\"\n\t\"HealthAPI/internal/models\"\n)\n\nfunc TestCreateDoctor(t *testing.T) {\n\tdoctor := models.Doctor{\n\t\tName:     \"Dr. Smith\",\n\t\tSpecialty: \"Cardiology\",\n\t\tEmail:    \"drsmith@example.com\",\n\t}\n\tbody, _ := json.Marshal(doctor)\n\treq := httptest.NewRequest(\"POST\", \"/doctors\", bytes.NewBuffer(body))\n\tw := httptest.NewRecorder()\n\thandlers.CreateDoctor(w, req)\n\tif w.Code != http.StatusCreated {\n\t\tt.Errorf(\"Expected 201, got %d\", w.Code)\n\t}\n}\n\nfunc TestGetDoctors(t *testing.T) {\n\treq := httptest.NewRequest(\"GET\", \"/doctors\", nil)\n\tw := httptest.NewRecorder()\n\thandlers.GetDoctors(w, req)\n\tif w.Code != http.StatusOK {\n\t\tt.Errorf(\"Expected 200, got %d\", w.Code)\n\t}\n}\n"
  },
  {
    "filename": "internal/handlers/record_test.go",
    "code": "package handlers_test\n\nimport (\n\t"bytes\"\n\t"encoding/json\"\n\t"net/http\"\n\t"net/http/httptest\"\n\t"testing\"\n\t\"HealthAPI/internal/handlers\"\n\t\"HealthAPI/internal/models\"\n)\n\nfunc TestCreateRecord(t *testing.T) {\n\trecord := models.Record{\n\t\tPatientID: 1,\n\t\tDoctorID:  1,\n\t\tNotes:     \"Routine checkup\",\n\t\tDate:      \"2023-10-01\",\n\t}\n\tbody, _ := json.Marshal(record)\n\treq := httptest.NewRequest(\"POST\", \"/records\", bytes.NewBuffer(body))\n\tw := httptest.NewRecorder()\n\thandlers.CreateRecord(w, req)\n\tif w.Code != http.StatusCreated {\n\t\tt.Errorf(\"Expected 201, got %d\", w.Code)\n\t}\n}\n\nfunc TestGetRecords(t *testing.T) {\n\treq := httptest.NewRequest(\"GET\", \"/records\", nil)\n\tw := httptest.NewRecorder()\n\thandlers.GetRecords(w, req)\n\tif w.Code != http.StatusOK {\n\t\tt.Errorf(\"Expected 200, got %d\", w.Code)\n\t}\n}\n"
  },
  {
    "filename": "internal/routes/routes.go",
    "code": "package routes\n\nimport (\n\t\"github.com/gorilla/mux\"\n\t\"HealthAPI/internal/handlers\"\n)\n\nfunc Register(r *mux.Router) {\n\t// Patient routes\n\tr.HandleFunc(\"/patients\", handlers.CreatePatient).Methods(\"POST\")\n\tr.HandleFunc(\"/patients\", handlers.GetPatients).Methods(\"GET\")\n\tr.HandleFunc(\"/patients/{id}\", handlers.GetPatient).Methods(\"GET\")\n\tr.HandleFunc(\"/patients/{id}\", handlers.UpdatePatient).Methods(\"PUT\")\n\tr.HandleFunc(\"/patients/{id}\", handlers.DeletePatient).Methods(\"DELETE\")\n\n\t// Doctor routes\n\tr.HandleFunc(\"/doctors\", handlers.CreateDoctor).Methods(\"POST\")\n\tr.HandleFunc(\"/doctors\", handlers.GetDoctors).Methods(\"GET\")\n\tr.HandleFunc(\"/doctors/{id}\", handlers.GetDoctor).Methods(\"GET\")\n\tr.HandleFunc(\"/doctors/{id}\", handlers.UpdateDoctor).Methods(\"PUT\")\n\tr.HandleFunc(\"/doctors/{id}\", handlers.DeleteDoctor).Methods(\"DELETE\")\n\n\t// Record routes\n\tr.HandleFunc(\"/records\", handlers.CreateRecord).Methods(\"POST\")\n\tr.HandleFunc(\"/records\", handlers.GetRecords).Methods(\"GET\")\n\tr.HandleFunc(\"/records/{id}\", handlers.GetRecord).Methods(\"GET\")\n\tr.HandleFunc(\"/records/{id}\", handlers.UpdateRecord).Methods(\"PUT\")\n\tr.HandleFunc(\"/records/{id}\", handlers.DeleteRecord).Methods(\"DELETE\")\n}\n"
  },
  {
    "filename": "cmd/main.go",
    "code": "package main\n\nimport (\n\t\"log\"\n\t\"net/http\"\n\t\"github.com/gorilla/mux\"\n\t\"HealthAPI/internal/routes\"\n)\n\nfunc main() {\n\tr := mux.NewRouter()\n\troutes.Register(r)\n\tlog.Println(\"Server listening on :8080\")\n\tlog.Fatal(http.ListenAndServe(\":8080\", r))\n}\n"
  },
  {
    "filename": "tasks.md",
    "code": "# Lab Tasks\n\n1. Implement the GetPatient handler to return a single patient by ID\n2. Add validation for required fields in CreatePatient handler\n3. Write additional test cases for UpdatePatient and DeletePatient handlers\n4. Implement error handling for patient not found scenarios\n5. Add pagination support for the GetPatients endpoint\n6. Implement similar tasks for Doctor and Record entities\n"
  }
]
--- END ---
ğŸ§¾ Saved ML metrics â†’ experiments/HealthAPI/gen_metrics.json
2025/10/20 04:56:11 âš ï¸  ML generation failed once: failed to parse repaired output: json parse error: invalid character 'e' after object key:value pair
2025/10/20 04:56:11 ğŸ” Retrying with relaxed mode...
2025/10/20 04:56:11 ğŸª„ Using relaxed ML generation mode (cleaning JSON output)...
ğŸŒ Using custom endpoint: https://api.openai.com/v1
ğŸ¤– Trying model: gpt-4o-mini
â±ï¸  Model call took 40.036939863s (model: gpt-4o-mini, attempt: 1)
âœ… Parsed 12 files

ğŸ“Š Generation Summary:
  â€¢ Duration: 40.037288469s
  â€¢ Primary Success: true
  â€¢ Repair Attempts: 0
  â€¢ Final Success: true
  â€¢ Error: 
âœ… HealthAPI generation completed successfully
ğŸ§¾ Saved ML metrics â†’ experiments/HealthAPI/gen_metrics.json
2025/10/20 04:56:51 âœ… Normal ML generation succeeded â€” no relaxed mode needed.
ğŸ“ Processing: internal/models/patient.go
âœ… Written: experiments/out/HealthAPI/internal/models/patient.go
ğŸ“ Processing: internal/models/doctor.go
âœ… Written: experiments/out/HealthAPI/internal/models/doctor.go
ğŸ“ Processing: internal/models/record.go
âœ… Written: experiments/out/HealthAPI/internal/models/record.go
ğŸ“ Processing: internal/handlers/patient.go
ğŸ”§ Fixed handler signature for CreatePatient
ğŸ”§ Fixed handler signature for GetPatients
ğŸ”§ Fixed handler signature for GetPatient
ğŸ”§ Fixed handler signature for UpdatePatient
ğŸ”§ Fixed handler signature for DeletePatient
âœ… Written: experiments/out/HealthAPI/internal/handlers/patient.go
ğŸ“ Processing: internal/handlers/doctor.go
ğŸ”§ Fixed handler signature for CreateDoctor
ğŸ”§ Fixed handler signature for GetDoctors
ğŸ”§ Fixed handler signature for GetDoctor
ğŸ”§ Fixed handler signature for UpdateDoctor
ğŸ”§ Fixed handler signature for DeleteDoctor
âœ… Written: experiments/out/HealthAPI/internal/handlers/doctor.go
ğŸ“ Processing: internal/handlers/record.go
ğŸ”§ Fixed handler signature for CreateRecord
ğŸ”§ Fixed handler signature for GetRecords
ğŸ”§ Fixed handler signature for GetRecord
ğŸ”§ Fixed handler signature for UpdateRecord
ğŸ”§ Fixed handler signature for DeleteRecord
âœ… Written: experiments/out/HealthAPI/internal/handlers/record.go
ğŸ“ Processing: internal/handlers/patient_test.go
ğŸ”§ Fixed test signature for TestCreatePatient
ğŸ”§ Fixed test signature for TestGetPatients
âœ… Auto-fixed test signatures in internal/handlers/patient_test.go
âœ… Written: experiments/out/HealthAPI/internal/handlers/patient_test.go
ğŸ“ Processing: internal/handlers/doctor_test.go
ğŸ”§ Fixed test signature for TestCreateDoctor
ğŸ”§ Fixed test signature for TestGetDoctors
âœ… Auto-fixed test signatures in internal/handlers/doctor_test.go
âœ… Written: experiments/out/HealthAPI/internal/handlers/doctor_test.go
ğŸ“ Processing: internal/handlers/record_test.go
ğŸ”§ Fixed test signature for TestCreateRecord
ğŸ”§ Fixed test signature for TestGetRecords
âœ… Auto-fixed test signatures in internal/handlers/record_test.go
âœ… Written: experiments/out/HealthAPI/internal/handlers/record_test.go
ğŸ“ Processing: internal/routes/routes.go
ğŸ”§ Fixed Register function parameter
âœ… Written: experiments/out/HealthAPI/internal/routes/routes.go
ğŸ“ Processing: cmd/main.go
âœ… Written: experiments/out/HealthAPI/cmd/main.go
ğŸ“ Processing: tasks.md
âš ï¸  Syntax validation failed for tasks.md: temp.go:1:1: illegal character U+0023 '#'
ğŸ”§ Attempting additional fixes...
âŒ Could not auto-fix syntax errors in tasks.md
âœ… Written: experiments/out/HealthAPI/tasks.md

ğŸ”§ Total rule-based fixes applied: 25

ğŸ”§ Running auto-fix on generated files...

ğŸ”§ Auto-fixing all files in: experiments/out/HealthAPI

ğŸ“ Fixing test function signatures...
  âœ… Fixed test signatures in doctor_test.go
  âœ… Fixed test signatures in patient_test.go
  âœ… Fixed test signatures in record_test.go

ğŸ“ Fixing handler function signatures...

ğŸ“ Fixing routes Register function...

ğŸ“ Fixing missing commas in struct literals...

ğŸ“ Ensuring test file imports...

âœ… Applied 3 fixes total!
âœ… Auto-fix completed successfully

ğŸ” Validating Go syntax...
âœ… All generated files have valid Go syntax
2025/10/20 04:56:51 âœ… Generated 3 test file(s)

ğŸ”§ Fixing import paths...
2025/10/20 04:56:51 ğŸ”§ Detected module name: HealthAPI â€” fixing imports...
2025/10/20 04:56:51 âœ… No import fixes needed
ğŸ”§ Running go mod tidy...
âœ… Dependencies tidied

ğŸ” Final syntax validation after fixes...
âœ… All syntax errors resolved
âœ… ML generation completed (40.04s)
ğŸ“ Saved per-package coverage â†’ experiments/out/HealthAPI/coverage.json
ğŸ§¾ Added summary row (with ML metrics) â†’ experiments/logs/coverage.csv

--- go test summary ---

--- experiments/out/HealthAPI/internal/handlers ---
=== RUN   TestCreateDoctor
--- PASS: TestCreateDoctor (0.00s)
=== RUN   TestGetDoctors
--- PASS: TestGetDoctors (0.00s)
=== RUN   TestCreatePatient
--- PASS: TestCreatePatient (0.00s)
=== RUN   TestGetPatients
--- PASS: TestGetPatients (0.00s)
=== RUN   TestCreateRecord
--- PASS: TestCreateRecord (0.00s)
=== RUN   TestGetRecords
--- PASS: TestGetRecords (0.00s)
PASS
coverage: 53.3% of statements
ok  	HealthAPI/internal/handlers	0.003s

------------------------
âœ… Validation completed in 0.99s

ğŸ“Š Summary for HealthAPI:
  â€¢ BuildSuccess = true
  â€¢ LintWarnings = 3
  â€¢ TestsPass    = true
  â€¢ Coverage     = 53.3%
  â€¢ Generation Duration = 40.037288469s
  â€¢ Repair Attempts = 0
  â€¢ Rule Fixes   = 25
  â€¢ Mode: hybrid
ğŸ§¾ Appended 30 experiments into experiments/logs/summary.csv

ğŸ§¾ Generating Markdown summary from JSON metrics...
ğŸ“Š Markdown results saved â†’ experiments/logs/results.md
âœ… Summary successfully written to experiments/logs/results.md

âœ… Experiment complete..
